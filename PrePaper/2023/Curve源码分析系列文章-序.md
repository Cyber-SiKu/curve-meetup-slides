## 前言

从18年写下第一行代码开始，通过社区小伙伴们的奋力编码，Curve的源码已经达到30万行，首先我代表Curve社区向各位Contributors表达诚挚的谢意，同时也期待有更多的小伙伴成为Curve项目的Contributor。

为了让新加入社区的小伙伴们能更容易的参与到Curve项目的开发，也为了让用户对Curve项目使用的技术架构和底层实现有更深入的理解，我们的几位社区小伙伴在业余时间逐步整理分析了Curve项目的核心代码流程，但是限于时间和能力问题，可能会有比较多的细节遗漏，也希望各位小伙伴们多多包涵，并欢迎大家共同参与到源码分析文档的补充、修正、完善这项工作中来。

## 源码分析的思路

对于一个中大型分布式存储项目来说，想要从0开始熟悉源码，是一件非常有挑战的事情，尤其是对新接触分布式存储领域的小伙伴来说，还需要有不少的知识储备过程，否则直接上手分析源码可能会事倍功半，无法顺利深入。

因此我们首先整理了Curve项目的预备知识，通过学习这些预备知识，相信大家就能对Curve项目架构和有个大概的理解。Curve项目的预备知识主要包括以下几个方面：

*   bRPC：protobuf等RPC框架的基础知识和用法，协程、线程池、执行队列等的使用，bvar metric体系的使用等等
*   bRAFT：bRAFT是一个Raft协议的具体实现，要用好他需要先深入了解Raft协议的具体原理和机制，然后再结合Curve项目的实际应用来分析源码流程
*   GFS架构：Curve的架构理念重点参考了GFS，因此阅读相关论文会对你分析Curve项目源码有比较大的帮助作用

另外我们在分析源码的过程中，主要关注如下几个方面的内容：

*   第三方库：比如gflags、jemalloc等，我们会详细介绍Curve项目是如何使用这些第三方库的，并且尽量给出我们选型的思考逻辑和相关依据
*   Curve自建基础模块：如限流、Locks、Cache、异步/回调、filepool、sdk接口等等，这部分是我们为了在Curve各个地方复用而提取的通用模块，也会提前进行介绍
*   核心流程：如创建卷、IO读写、扩容卷、快照克隆、心跳上报、选主逻辑、集群扩容等等，这部分是Curve源码分析的核心，也就是实际的业务逻辑代码流程分析
*   关键数据结构：这部分会结合具体的IO或操作流程来介绍

我们这个源码分析系列文章的目标是起到抛砖引玉的作用。

## 注意事项

限于时间和精力问题，源码分析文档的更新速度落后与新版本发布的频率（很多），所以一些流程的源码示例仅作为参考，请以最新版本的代码为准。

目前我们的源码分析系列文章已经有了初稿，发布在GitHub Curve源码仓库的wiki页面，欢迎提前阅读并提出改进意见。

在阅读本系列文章的过程中，如果你对相关源码流程有任何问题，都欢迎随时在Curve用户群里反馈交流。

